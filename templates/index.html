<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë‰´ìŠ¤ ì¸ì‚¬ì´íŠ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f4f6f9; }
        .card { border: none; border-radius: 12px; transition: 0.3s; }
        .card:hover { transform: translateY(-5px); }
        .summary-box { background-color: #f1f8ff; border-left: 5px solid #0d6efd; padding: 20px; border-radius: 8px; margin-top: 15px; }
        /* ì¢…í•© ë¶„ì„ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ (ê°•ì¡°) */
        .trend-box { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            border-radius: 15px; 
            margin-top: 50px;
            margin-bottom: 50px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .trend-content { white-space: pre-wrap; font-size: 1.1rem; line-height: 1.8; }
    </style>
</head>
<body class="bg-light">

    <div class="container py-5" style="max-width: 900px;">
        <div class="d-flex justify-content-between align-items-center mb-5">
            <div>
                <h1 class="fw-bold">ğŸ¤– AI ë‰´ìŠ¤ ì¸ì‚¬ì´íŠ¸</h1>
                <p class="text-muted mb-0">Google News ê¸°ë°˜ ì‹¤ì‹œê°„ ë¶„ì„</p>
            </div>
            <button onclick="runScrape()" id="scrapeBtn" class="btn btn-dark px-4 py-2 fw-bold shadow-sm">
                <span id="btnText">ğŸ”„ ë‰´ìŠ¤ ìˆ˜ì§‘ & ë¶„ì„ ì‹œì‘</span>
                <span id="spinner" class="spinner-border spinner-border-sm d-none"></span>
            </button>
        </div>
        <div style="background-color: #f0f0f0; padding: 20px; margin-bottom: 20px; border-radius: 10px;">
            <h3>ğŸ“¬ AI ë‰´ìŠ¤ ë¬´ë£Œ êµ¬ë…í•˜ê¸°</h3>
            <p>í…”ë ˆê·¸ë¨ìœ¼ë¡œ ë§¤ì¼ ì•„ì¹¨ AI íŠ¸ë Œë“œ ìš”ì•½ì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</p>
            
            <form action="/subscribe" method="post">
                <label>ë‹‰ë„¤ì„: <input type="text" name="nickname" required placeholder="í™ê¸¸ë™"></label>
                <label>í…”ë ˆê·¸ë¨ Chat ID: <input type="text" name="chat_id" required placeholder="ìˆ«ì ID ì…ë ¥"></label>
                <button type="submit" style="background-color: #0088cc; color: white; border: none; padding: 5px 10px; cursor: pointer;">êµ¬ë… ì‹ ì²­</button>
            </form>
            
            <p style="font-size: 0.8em; color: #666;">
                â€» <b>ì£¼ì˜ì‚¬í•­:</b> ë°˜ë“œì‹œ ë¨¼ì € í…”ë ˆê·¸ë¨ ë´‡ì—ê²Œ ë§ì„ ê±¸ì–´ì•¼ ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                1. ëŒ€ë¶€ë¶„ì˜ ì‚¬ëŒë“¤ì€ ìì§„ì˜ chat IDë¥¼ ëª°ë¼ìš” <br>
                2. í…”ë ˆê·¸ë¨ì—ì„œ ë‚´ ë´‡ ê²€ìƒ‰ í›„ <b>/start</b> ëˆ„ë¥´ê¸°<br>
                3. <b>@userinfobot</b> ë“±ì„ í†µí•´ ë‚´ Chat ID(ìˆ«ì) ì•Œì•„ë‚´ê¸°
            </p>
        </div>

        <div class="row" id="newsContainer">
            {% for news in news_list %}
            <div class="col-12 mb-4">
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <small class="text-secondary">ğŸ“… {{ news.created_at }}</small>
                        <h3 class="card-title mt-2 fw-bold">{{ news.title }}</h3>
                        
                        <div class="summary-box">
                            <div style="white-space: pre-wrap;">{{ news.summary | safe }}</div>
                        </div>
                        
                        <div class="mt-3 text-end">
                            <a href="{{ news.link }}" target="_blank" class="btn btn-outline-primary btn-sm rounded-pill px-3">
                                ğŸ“„ ì›ë¬¸ ê¸°ì‚¬ ì½ê¸°
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="trend-box">
            <h2 class="fw-bold mb-4">ğŸ“Š ì˜¤ëŠ˜ì˜ AI ì‚°ì—… ì¢…í•© ë¸Œë¦¬í•‘</h2>
            <div class="trend-content">
                {{ trend_report | safe }}
            </div>
            <div class="mt-3 text-white-50 text-end">
                * ìˆ˜ì§‘ëœ ìƒìœ„ 10ê°œ ë‰´ìŠ¤ë¥¼ ë°”íƒ•ìœ¼ë¡œ AIê°€ ìƒì„±í•œ ë³´ê³ ì„œì…ë‹ˆë‹¤.
            </div>
        </div>

    </div>

    <script>
        async function runScrape() {
            const btn = document.getElementById('scrapeBtn');
            const btnText = document.getElementById('btnText');
            const spinner = document.getElementById('spinner');

            if(!confirm("ë‰´ìŠ¤ë¥¼ ìˆ˜ì§‘í•˜ê³  ë¶„ì„í•˜ëŠ” ë° ì•½ 10~20ì´ˆê°€ ì†Œìš”ë©ë‹ˆë‹¤. ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            btn.disabled = true;
            btnText.innerText = "ë°ì´í„° ë¶„ì„ ì¤‘...";
            spinner.classList.remove('d-none');

            try {
                const response = await fetch('/scrape');
                const result = await response.json();
                alert(result.message);
                location.reload(); 
            } catch (error) {
                alert("ì˜¤ë¥˜ ë°œìƒ");
            } finally {
                btn.disabled = false;
                spinner.classList.add('d-none');
            }
        }
    </script>
</body>
</html>